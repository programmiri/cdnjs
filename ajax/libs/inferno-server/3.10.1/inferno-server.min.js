!(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server={}),e.Inferno,e.stream)})(this,(function(e,t,r){"use strict";function n(e){var t=typeof e;return"string"===t||"number"===t}function o(e){return p(e)||l(e)}function i(e){return l(e)||!1===e||c(e)||p(e)}function s(e){return"function"==typeof e}function u(e){return"string"==typeof e}function a(e){return"number"==typeof e}function l(e){return null===e}function c(e){return!0===e}function p(e){return void 0===e}function d(e){throw e||(e=M),new Error("Inferno Error: "+e)}function f(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function h(){this.listeners=[]}function v(e){if(!N.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}function m(e){return P.hasOwnProperty(e)?P[e]:P[e]=e.replace(w,"-$&").toLowerCase()+":"}function g(e){if(u(e))return e;var r="";for(var n in e){var o=e[n];u(o)?r+=""+m(n)+o+";":a(o)&&(r+=""+m(n)+o+(t.internal_isUnitlessNumber.has(n)?"":"px")+";")}return r}function y(e){for(var t=[],r=e&&Object.keys(e)||[],n=0,o=r.length;n<o;n++){var i=r[n];if("children"!==i&&"dangerouslySetInnerHTML"!==i&&"style"!==i){var s=e[i];u(s)?t.push(i+'="'+v(s)+'"'):a(s)?t.push(i+'="'+s+'"'):c(s)&&t.push(i)}}return t}function S(e,r,n,p){var h=e.flags,m=e.type,y=e.props||t.EMPTY_OBJ,_=e.children;if((28&h)>0){if(4&h){var x=new m(y,n);x._blockSetState=!1;var T;if(s(x.getChildContext)&&(T=x.getChildContext()),T=o(T)?n:f(n,T),x.props===t.EMPTY_OBJ&&(x.props=y),x.context=n,x._unmounted=!1,s(x.componentWillMount)){if(x._blockRender=!0,x.componentWillMount(),x._pendingSetState){var Q=x.state,k=x._pendingState;if(null===Q)x.state=k;else for(var b in k)Q[b]=k[b];x._pendingSetState=!1,x._pendingState=null}x._blockRender=!1}var M=x.render(y,x.state,x.context);return i(M)?"\x3c!--!--\x3e":S(M,e,T,!0)}var N=m(y,n);return i(N)?"\x3c!--!--\x3e":S(N,e,n,!0)}if((3970&h)>0){var w,P="<"+m,A=I.has(m),R=e.className;if(u(R)?P+=' class="'+v(R)+'"':a(R)&&(P+=' class="'+R+'"'),!l(y)){for(var E in y){var O=y[E];"dangerouslySetInnerHTML"===E?w=O.__html:"style"===E?P+=' style="'+g(y.style)+'"':"children"===E||("defaultValue"===E?y.value||(P+=' value="'+(u(O)?v(O):O)+'"'):"defaultChecked"===E?y.checked||(P+=' checked="'+O+'"'):u(O)?P+=" "+E+'="'+v(O)+'"':a(O)?P+=" "+E+'="'+O+'"':c(O)&&(P+=" "+E))}"option"===m&&void 0!==y.value&&y.value===r.props.value&&(P+=" selected")}if(A)P+=">";else{if(P+=">",i(_))w&&(P+=w);else if(u(_))P+=""===_?" ":v(_);else if(a(_))P+=_+"";else if(C(_))for(var V=0,j=_.length;V<j;V++){var L=_[V];u(L)?P+=""===L?" ":v(L):a(L)?P+=L:i(L)||(P+=S(L,e,n,0===V))}else P+=S(_,e,n,!0);A||(P+="</"+m+">")}return P}if((1&h)>0)return(p?"":"\x3c!----\x3e")+(""===_?" ":v(_));d()}function _(e){return S(e,{},{},!0)}function x(e){return S(e,{},{},!0)}function T(e){return new A(e,!1)}function Q(e){return new A(e,!0)}function k(e){return new E(e,!1)}function b(e){return new E(e,!0)}var M="a runtime error occured! Use Inferno in development environment to find the error.",C=Array.isArray;h.prototype.addListener=function(e){this.listeners.push(e)},h.prototype.trigger=function(){for(var e,t=this.listeners;e=t.shift();)e()};var N=/["'&<>]/,w=/[A-Z]/g,P={},I=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),A=(function(e){function r(t,r){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,r,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||s(e))&&s(e.then)){var t=this;e.then((function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r})),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,n,h){var m=this;if(i(e))this.addToQueue("\x3c!--!--\x3e",h);else{var y=e.flags,S=e.type,_=e.props||t.EMPTY_OBJ,x=e.children;if((28&y)>0)if(4&y){var T=new S(_,r);T._blockSetState=!1;var Q;if(p(T.getChildContext)||(Q=T.getChildContext()),o(Q)||(r=f(r,Q)),T.props===t.EMPTY_OBJ&&(T.props=_),T.context=r,T._unmounted=!1,s(T.componentWillMount)){if(T._blockRender=!0,T.componentWillMount(),T._pendingSetState){var k=T.state,b=T._pendingState;if(null===k)T.state=b;else for(var M in b)k[M]=b[M];T._pendingSetState=!1,T._pendingState=null}T._blockRender=!1}if(s(T.getInitialProps)){var N=T.getInitialProps(T.props,T.context);if(N){if(Promise.resolve(N)===N){var w=this.promises.push([])-1;return void this.addToQueue(N.then((function(e){return T._pendingSetState=!1,"object"==typeof e&&(T.props=f(T.props,e)),m.renderVNodeToQueue(T.render(T.props,T.state,T.context),T.context,!0,w),setTimeout(m.pushQueue,0),w})),h)}T.props=f(T.props,N)}}var P=T.render(_,T.state,e.context);T._pendingSetState=!1,this.renderVNodeToQueue(P,r,!0,h)}else{var A=S(_,r);this.renderVNodeToQueue(A,r,!0,h)}else if((3970&y)>0){var R,E="<"+S,O=I.has(S),V=e.className;if(u(V)?E+=' class="'+v(V)+'"':a(V)&&(E+=' class="'+V+'"'),!l(_))for(var j in _){var L=_[j];"dangerouslySetInnerHTML"===j?R=L.__html:"style"===j?E+=' style="'+g(_.style)+'"':"children"===j||("defaultValue"===j?_.value||(E+=' value="'+(u(L)?v(L):L)+'"'):"defaultChecked"===j?_.checked||(E+=' checked="'+L+'"'):u(L)?E+=" "+j+'="'+v(L)+'"':a(L)?E+=" "+j+'="'+L+'"':c(L)&&(E+=" "+j))}if(O)this.addToQueue(E+">",h);else{if(E+=">",i(x)){if(R)return void this.addToQueue(E+R+"</"+S+">",h)}else{if(!C(x))return u(x)?void this.addToQueue(E+v(x)+"</"+S+">",h):a(x)?void this.addToQueue(E+x+"</"+S+">",h):(this.addToQueue(E,h),this.renderVNodeToQueue(x,r,!0,h),void this.addToQueue("</"+S+">",h));this.addToQueue(E,h),E="";for(var W=0,H=x.length;W<H;W++){var B=x[W];u(B)?m.addToQueue(v(B),h):a(B)?m.addToQueue(B+"",h):i(B)||m.renderVNodeToQueue(B,r,0===W,h)}}O||this.addToQueue(E+"</"+S+">",h)}}else(1&y)>0?this.addToQueue((n?"":"\x3c!----\x3e")+v(x),h):d()}},r})(r.Readable),R=Promise.resolve(),E=(function(e){function t(t,r){e.call(this),this.started=!1,this.initNode=t,this.staticMarkup=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,R.then((function(){return e.renderNode(e.initNode,null,e.staticMarkup)})).then((function(){e.push(null)})).catch((function(t){e.emit("error",t)})))},t.prototype.renderNode=function(e,t,r){if(!i(e)){var n=e.flags;return(28&n)>0?this.renderComponent(e,r,t,4&n):(3970&n)>0?this.renderElement(e,r,t):this.renderText(e)}},t.prototype.renderComponent=function(e,t,r,n){var i=this,u=e.type,a=e.props;if(!n)return this.renderNode(u(a),r,t);var l=new u(a);l._blockSetState=!1;var c;return s(l.getChildContext)&&(c=l.getChildContext()),o(c)||(r=f(r,c)),l.context=r,l._blockRender=!0,Promise.resolve(l.componentWillMount&&l.componentWillMount()).then((function(){if(l._pendingSetState){var e=l.state,n=l._pendingState;if(null===e)l.state=n;else for(var o in n)e[o]=n[o];l._pendingSetState=!1,l._pendingState=null}l._blockRender=!1;var s=l.render(l.props,l.state,l.context);return l._pendingSetState=!1,i.renderNode(s,r,t)}))},t.prototype.renderChildren=function(e,t){var r=this;if(u(e))return this.push(v(e));if(a(e))return this.push(e+"");if(e){var o=C(e);if(!o&&!i(e))return this.renderNode(e,t,!1);if(!o)throw new Error("invalid component");return e.reduce((function(e,o){return e.then((function(e){return n(o)?(!0===e&&r.push("\x3c!----\x3e"),u(o)?r.push(v(o)):r.push(o+""),!0):C(o)?(r.push("\x3c!----\x3e"),Promise.resolve(r.renderChildren(o)).then((function(){return r.push("\x3c!--!--\x3e"),!0}))):i(o)?void 0:((1&o.flags)>0&&e&&r.push("\x3c!----\x3e"),Promise.resolve(r.renderNode(o,t,!1)).then((function(){return!!(1&o.flags)})))}))}),Promise.resolve(!1))}},t.prototype.renderText=function(e){var t=this;return R.then((function(r){return t.push(e.children),r}))},t.prototype.renderElement=function(e,t,r){var n=this,o=e.type,i=e.props,s=y(i),l="",c=e.className;if(u(c)?s.push('class="'+v(c)+'"'):a(c)&&s.push('class="'+c+'"'),i){var p=i.style;p&&s.push('style="'+g(p)+'"'),i.dangerouslySetInnerHTML&&(l=i.dangerouslySetInnerHTML.__html)}if(t&&s.push("data-infernoroot"),this.push("<"+o+(s.length>0?" "+s.join(" "):"")+">"),!I.has(o))return l?(this.push(l),void this.push("</"+o+">")):Promise.resolve(this.renderChildren(e.children,r)).then((function(){n.push("</"+o+">")}))},t})(r.Readable),O={RenderQueueStream:A,RenderStream:E,renderToStaticMarkup:x,renderToString:_,streamAsStaticMarkup:b,streamAsString:k,streamQueueAsStaticMarkup:Q,streamQueueAsString:T};e.default=O,e.RenderQueueStream=A,e.RenderStream=E,e.renderToStaticMarkup=x,e.renderToString=_,e.streamAsStaticMarkup=b,e.streamAsString=k,e.streamQueueAsStaticMarkup=Q,e.streamQueueAsString=T,Object.defineProperty(e,"__esModule",{value:!0})}));
